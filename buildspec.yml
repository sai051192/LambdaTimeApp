version: 0.2

env:
  secrets-manager:
    CLOUDGUARD_ID: Cloudguard_API_key:cloudguard_ID 
    CLOUDGUARD_KEY: Cloudguard_API_key:cloudguard_secret

phases:
  install:
    runtime-versions:
        nodejs: 10
  build:
    commands:
      - npm install time
      - npm install -g https://artifactory.app.protego.io/cloudguard-serverless-plugin.tgz
      - export BUCKET=app2artifactucket
      - cloudguard fsp add -t $CLOUDGUARD_ID:$CLOUDGUARD_KEY -C template.yaml --region us-east-1 --output template1.yaml
      - aws cloudformation package --template-file template1.yaml --s3-bucket $BUCKET --output-template-file outputtemplate.yaml
      - 
artifacts:
  type: zip
  files:
    - template1.yaml
    - outputtemplate.yaml
